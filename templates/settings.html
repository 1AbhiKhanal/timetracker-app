{% extends "base.html" %}

{% block content %}
<div class="row">
  <div class="col-md-4">
    <div class="card">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-user-circle"></i> Profile</h5>
      </div>
      <div class="card-body text-center">
        <img src="{% if user.profile_pic and user.profile_pic != 'default.png' %}/static/uploads/{{ user.profile_pic }}{% else %}/static/default-avatar.svg{% endif %}" 
             alt="Profile" class="rounded-circle mb-3" width="100" height="100">
        <h5>{{ user.name }}</h5>
        <p class="text-muted small">Joined: {{ user.created_at.strftime("%d %B %Y") }}</p>
        
        <form method="post" enctype="multipart/form-data">
          <input type="hidden" name="action" value="upload_pic">
          <div class="mb-3">
            <input type="file" name="profile_pic" class="form-control form-control-sm" accept="image/*" required>
          </div>
          <button type="submit" class="btn btn-sm btn-primary w-100">
            <i class="fas fa-upload"></i> Upload Picture
          </button>
        </form>
      </div>
    </div>
  </div>

  <div class="col-md-8">
    {% if 'success' in get_flashed_messages(category_filter=['success']) %}
      {% for message in get_flashed_messages(category_filter=['success']) %}
        <div class="alert alert-success alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}

    {% if 'danger' in get_flashed_messages(category_filter=['danger']) %}
      {% for message in get_flashed_messages(category_filter=['danger']) %}
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endfor %}
    {% endif %}

    <!-- Change Username -->
    <div class="card mb-3">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-user"></i> Change Username</h5>
      </div>
      <div class="card-body">
        <form method="post">
          <input type="hidden" name="action" value="change_username">
          <div class="mb-3">
            <label class="form-label">Current Username</label>
            <input type="text" class="form-control" value="{{ user.name }}" disabled>
          </div>
          <div class="mb-3">
            <label class="form-label">New Username</label>
            <input type="text" name="new_username" class="form-control" placeholder="Enter new username" required>
          </div>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-check"></i> Update Username
          </button>
        </form>
      </div>
    </div>

    <!-- Update Email -->
    <div class="card mb-3">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-envelope"></i> Email Address</h5>
      </div>
      <div class="card-body">
        <form method="post">
          <input type="hidden" name="action" value="update_email">
          <div class="mb-3">
            <label class="form-label">Email</label>
            <input type="email" name="email" class="form-control" value="{{ user.email or '' }}" placeholder="Enter email">
          </div>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-check"></i> Update Email
          </button>
        </form>
      </div>
    </div>

    <!-- Update Phone -->
    <div class="card mb-3">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-phone"></i> Phone Number</h5>
      </div>
      <div class="card-body">
        <form method="post">
          <input type="hidden" name="action" value="update_phone">
          <div class="mb-3">
            <label class="form-label">Phone</label>
            <input type="text" name="phone" class="form-control" value="{{ user.phone or '' }}" placeholder="Enter phone">
          </div>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-check"></i> Update Phone
          </button>
        </form>
      </div>
    </div>

    <!-- Change Password -->
    <div class="card mb-3">
      <div class="card-header">
        <h5 class="mb-0"><i class="fas fa-lock"></i> Change Password</h5>
      </div>
      <div class="card-body">
        <form method="post">
          <input type="hidden" name="action" value="change_password">
          <div class="mb-3">
            <label class="form-label">Current Password</label>
            <input type="password" name="current_password" class="form-control" placeholder="Enter current password" required>
          </div>
          <div class="mb-3">
            <label class="form-label">New Password</label>
            <input type="password" name="new_password" class="form-control" placeholder="Enter new password (min 6 chars)" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Confirm New Password</label>
            <input type="password" name="confirm_password" class="form-control" placeholder="Confirm new password" required>
          </div>
          <button type="submit" class="btn btn-primary">
            <i class="fas fa-check"></i> Update Password
          </button>
        </form>
      </div>
    </div>

  </div>
</div>

<a href="/dashboard" class="btn btn-secondary mt-3">
  <i class="fas fa-arrow-left"></i> Back to Dashboard
</a>
{% endblock %}